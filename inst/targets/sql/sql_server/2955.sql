CREATE TABLE #Codesets (
  codeset_id int NOT NULL,
  concept_id bigint NOT NULL
)
;

INSERT INTO #Codesets (codeset_id, concept_id)
SELECT 6 as codeset_id, c.concept_id FROM (select distinct I.concept_id FROM
( 
  select concept_id from @vocabulary_database_schema.CONCEPT where concept_id in (257581,45769441,46273452,40481763,43530693,45773005,36684328,45769438,46269767,45769442,45769443,46274124,46269777,45769352,46273462,45769351,46269785,46274059,45769350,46269771,37116845,4191479,45766728,45766727,4271333,45757063,46269801,4250128,317009,4211530,45772073,42535716,43530745,4206340,46274062,4233784,4143474,4075237,4225553,4245676,4051466,44810117,256448,46269802,4119300,313236,4217558,4244339,42538744,36684335,1340255,4138760,45768911,45772937,45768912,443801,4123253,312950,761844,37310241,4141978,46270030,46270322,4145497,252658,4225554,4119298,35609846,42536207,35609847,4057952,4155468,4146581,46269776,4143828,46270029,4022592,4110051,42536208,4155469,46269784,4142738,46273454,37206717,4309833,4155470,4212099,37109103,764677,764949,4232595,4080516,40483397,4152913,37208352,37108580,46269770,4145356,46270028,37108581,46273635,4312524,4120261,4301938,3661412,42539549,45768910,45768963,45768964,42536649,45768965,4245292)

) I
) C UNION ALL 
SELECT 8 as codeset_id, c.concept_id FROM (select distinct I.concept_id FROM
( 
  select concept_id from @vocabulary_database_schema.CONCEPT where concept_id in (2030131064,35155561,35151981,790206,36009434,790207,1511445,36006436,1511446,36506576,36509331,40173401,40173402,40173403,40173404,44217600,40243202,44892445,40243203,44814264,35519070,44814265,44814266,44464877,44814267,42654763,42708504,3943418,36501739,780240,1995545,42708505,44924893,42708508,42654762,36348221,780239,1995546,42708509,45282821,40173399,45316961,40173400,42708374,44410999,42708375,41522498,41522303,41522302,41522418,41522521,41522503,41522378,41522483,41522442,41522385,40169216,45145646,40169217,44446929,45117948,40169218,3943566,40169219,45316751,40169230,44958413,40169231,3943564,40169232,45248363,40169233,40169234,45350720,40169235,3943565,40169236,45196902,40169237,42629523,44448797,42629527,44431035,44440540,1361703,36499732,1361704,36118129,36118130,42708510,45145200,42708511,36118123,42708512,44974977,42708513,36118126,1361705,36499730,1361706,44818261,45873649,44818262,44818265,45871546,44818266,19127762,44855886,19127763,792485,36497307,792490,36497563,43531861,44924665,45775246,44992334,45776183,45873728,45776184,37003602,36380403,37003603,36380404,46234368,46253310,46234370,46254202,45776186,45861102,45776297,40169242,45248362,40169243,40169244,44856346,40169245,40169246,45282610,40169247,19127768,45350267,905271,44896850,21138024,21147888,21069475,21098837,21079225,40717377,21118403,21069474,21098836,21128170,21118402,21030096,40717378,21030097,21059515,43292286,43276106,43265066,43286913,43297695,43292287,43259648,43259647,21049732,43187380,44135478,44135475,43259649,43292288,43281452,43259651,21039938,21088945,21167639,21167638,43176434,43198398,43143276,43154429,43187381,43209229,43198399,43209230,43165393,21108663,21059517,21039937,21059516,43286914,43281454,43265067,43281453,43297696,43292289,43259650,43276107,43281455,43292290,42921728,40717376,40717371,40717369,40717370,40717373,40717372,40717374,40717375,21069476,21177380,21167637,21079226,43259652,21118405,21128171,43187382,43187383,21118404,21147889,21157864,21069473,21059514,43292285,35788173,43297694,21088944,21138025,21088943,43292284,21157863,21147887,21108661,43270556,40717379,21039936,43259646,21108662,43270557,36809528,36809503,36809477,36809507,36809520,36809526,36809518,36809523,36809529,36809521,36809500,43039759,43039756,43039757,36809496,36809515,36809497,36809512,36809519,36809504,36809531,43039761,43632174,43650291,43686244,43686245,43775974,43632172,43866352,43614022,43704186,43848099,43848100,43848102,43650292,43757987,43812048,43830058,43632173,43740086,43757988,43614020,43614021,43866353,43596093,43866354,43596094,43650293,43866355,43848101,43721962,43812049,43757989,43686243,43704185,43775973,43793900,43686246,43721963,43596096,43793901,43650294,43650295,43793902,43686248,43812050,43721964,43614023,43686247,43740087,43866356,43830059,43596095,43848103,43614024,43632175,43614025,43757990,36055364,36922148,36942982,2905553,2905545,2905549,2905548,2905546,2905551,2905547,2905554,2905552,2905550,36930604,36944733,2905564,2905544,36933456,36950014,36967151,36920300,36941164,36809427,36809431,36809411,41522766,41522644,44217932,44218045,44218092,21089279,21030457,43043757,21030462,21118753,44218079,44218139,44218097,44217981,44217992,44218027,44218046,44217934,21040281,21158229,44217926,44218095,44218128,44217991,41522643,41522659,41522676,44218096,41522672,44217892,41522707,44218091,41522600,41522712,41522607,41522650,41522623,44218044,41522799,41522637,44218129,44218138,44217824,44218093,44217853,44217808,44218160,46234464,35524519,46234508,46253755,46254635,1113041,45078407,1113079,45233215,35524520,44463071,1192251,44432825,35700165,44426744,1192272,45279245,45085908,40169204,45026707,40169205,40242513,45060852,40242514,46233856,46249581,46233860,46251881,40166837,45043689,40166838,44898811,35603332,44443156,35603333,45774779,45863237,45774780,45867369,35421232,37499734,37499739,46221170,36104603,46221171,46331172,46332146,1201587,36973371,1201588,1510779,36175775,1510780,792493,36496341,792494,600058,43531871,45043708,45775248,45776178,45875906,45776180,37003604,36380402,37003605,600059,46234373,46255514,46234374,45776300,45867353,45776301,19129676,45299281,19129677,905292,45009017,905293,44785540,45248371,44785541,45774870,21059837,21128471,45871562,45775241,2906276,2906275,1944077,35421260,21138358,41521553,44217133,44217049,41521446,21118715,44217048,21079557,41521444,21167956,21158192,21089249,21030419,37499737,36601732,37499738,36872986,36872987,42873622,36104730,42873623,46330131,42708514,44924894,42708515,44839377,40173447,45043908,40173448,42708516,45350914,42708517,44839376,19130453,42844311,19130455,42844312,45330321,41521588,36964746,19130450,41521453,42844309,19130452,42844310,45159346,41521525,41521591,41521491,41521590,41521532,41521604,41521510,41521602,41521605,41521559,41521517,36921251,42708372,42708373,44217031,36121651,36121652,36121644,36121645,36121646,36121650,36121648,36121649,36121647,36121642,21118709,21040236,21030411,36121643,21128479,21167948,21079544,21079545,44217164,21148210,21089240,21148213,21030414,21148212,21099166,21059853,21177670,21118711,44217223,43042915,43042916,44217032,44217096,44217246,44217189,21069794,21118710,21059852,21138347,21079549,21128480,21079548,21128481,44217222,43042911,43042912,40713555,40713554,21167945,21059844,21059846,44217203,41521509,21108979,44217072,21059845,21128478,44217125,21167946,21138342,21059843,44217165,21138345,21138346,21099165,21138344,21050023,21158180,21079547,21069793,21138343,21059851,21050022,40169262,45214157,40169263,40169264,45111908,40169267,44432108,1593840,35700467,36197498,1593842,44437873,44417367,40169269,737789,1224716,748446,585185,40169270,44992322,45163367,44935879,1366746,1788929,40169271,44975429,40169272,44440312,1593825,35700469,36197497,1593830,44413237,44450125,40169275,45162784,40169276,40169279,45282613,40169280,44417096,1593834,35700468,35519114,1593836,44443283,44440529,40169281,36977827,737790,42519849,635456,1224717,748445,585186,40169282,45060856,44466473,1366747,1528945,1788930,40169283,44958408,40169284,737791,40169285,748444,585187,40169286,45094765,45163385,1366748,1788931,46276021,45077437,46276022,36118124,36118125,46276023,45247886,46276024,36118127,36118128,905294,44872849,905295,46233863,46251882,46233864,40713493,40713492,45775128,45863195,45775129,40713499,40713498,40166801,44217023,45367700,40166802,21138351,21099168,44217168,44217229,21059857,44217193,21138352,21158184,21167954,21138350,35603327,44424056,35603329,45774774,45865306,45774776,42919657,40713447,40713448,40713449,40713450,44785544,44924666,44785545,45863080,45892417,45861055,45892418,44887172,45057334,44587423,21101415,43279287,21052330,43205324,44072714,44062403,44098516,43268402,43273912,44059884,44036268,43295529,43273913,44098515,44101007,21130706,21170230,44072711,44062397,44098514,44036267,44098513,44049392,44124546,44049391,44111352,44049390,43172439,43183357,43194370,43183358,43216222,43139335,21140654,21081762,43273914,43279289,43279288,43290100,43290101,43257513,42931131,40723312,40723313,21072076,43262897,21052331,43205325,44062398,44087993,35131371,36813544,41931827,41893441,41899383,963844,36497272,963845,963842,36497797,963843,41973648,35316851,41907581,42068005,1958267,36883826,43586242,43766219,43730318,43694453,43838431,43658604,43622303,43676647,43604391,43838435,43838432,43694454,43766215,43802219,43766214,43730316,43838433,43604392,43766216,43748224,43802220,43784328,43856467,43802221,43658606,43658607,43676648,43712283,43748226,43766220,43658605,43784329,41891380,41890626,41891386,43232549,41891572,41951414,1142116,1511248,42637463,35198771,833002,37407545,1623700,769422,584875,36330313,37300601,36117133,36389446,35839253,35500520,1154621,36397943,42840550,45360336,35905256,1511247,1372438,35505692,42695134,1226338,40163900,42842422,45128671,44437522,45036162,45376084,44465650,19131109,45868557,19131111,46252607,36180773,36179415,44839157,45343168,37517854,36176811,1511246,36090720,36773036,1565597,42647605,36348087,800337,42646473,42867665,36007110,36327180,36389449,37316231,36007007,1225952,1994735,36090719,1565790,42695135,35839254,1357952,36389448,36992096,1154619,46365057,36180766,45280628,45212589,44461325,45189395,45056205,41953013,41891667,40220058,41902543,41955720,1305337,4048422,3188883,41912266,789792,36008282,789793,36008283,36008284,36008285,37002845,36381127,37002847,36381134,37002855,37002856,37002842,36381129,37002844,36381136,37002851,37002852,37002848,36381130,37002850,36381138,37002853,37002854,36798759,45146781,1154536,46365014,1374453,36875236,45352526,36327177,36327178,36327179,1627092,1983701,1983702,1627093,45181240,43547706,37413344,19098332,45232471,1154535,36175950,1374454,36875197,45096605,36327174,36327175,36327176,1627090,1983703,1983704,1627091,44943133,44892035,43547707,37413343,19098331,45307601,19123989,36918293,36669365,36401523,1743569,36182618,45866440,44424551,44891732,45334858,45283729,45215304,45283730,44857466,45317860,45142023,45159175,593118,1583098,36868847,36496236,36497719,36496681,36497196,1530313,36389447,45144172,45042269,44889065,45025201,37418248,35904821,44943131,45079312,45010979,45198426,45147165,45011901,44858791,45029190,1530312,45378614,36353344,36348086,44463020,44463021,707871,707872,769306,36117134,36117135,36117136,44966486,42887763,44884698,45122305,45208253,1154373,1154374,19123990,40164014,37618303,43560451,37298951,37618304,37298952,37298953,46329752,46332759,42684617,35108374,37519780,823334,823335,36977475,35531135,726042,46330748,45871475,45865159,36479821,36480210,593119,36467210,36324167,36998070,45163015,45214376,45231582,44956990,45195422,44973981,45212705,44956991,36008766,36181234,1987363,44428829,44434236,45037488,44419965,44891735,44421350,44411745,45249486,3946259,44463128,36330562,1995572,45369115,45301195,45198422,44874861,1566876,999023,36143144,36143145,43560452,45290648,45051665,36946818,2928843,2928842,36964747,36953391,36301510,1154380,44955448,45318169,45020340,44433710,45188098,44900163,19130040,1154656,1154655,3963710,36301614,1111242,42635667,42635675,37319645,37319646,36869444,42635687,1579104,37319643,37319644,36868896,35300683,35300682,36318339,36318225,36200384,36200383,36143913,1626284,1626207,1626572,36143912,35301113,35301216,599311,599312,37319640,37319642,1828574,35301210,599313,599314,42635766,42635757,36117267,36117268,36333096,36333097,36348008,1544357,1111243,45006119,45330322,45023263,45040346,45040347,45142216,44887174,45176483,3970379,3964015,35408247,35409799,36259673,35407461,35742288,35409798,36885085,35409297,35408636,43713253,35410043,35406949,35408709,35406948,35409477,35411612,35407968,35410826,35411794,35767010,35760914,35412401,35752547,35744205,35408729,40723572,35760913,35773624,35752548,35756763,35769223,35742107,40723573,35769222,35756764,35760915,43288115,36262970,36262969,36268718,36270625,36260842,43036241,43036240,43036239,43036238,43036245,43036244,43036243,43036242,36950728,36934598,36924229,36957719,36067853,36926207,36938249,36956772,43036246,36928020,36919962,36958596,36067854,36923158,36959628,36963644,36963566,36933257,3949094,42708518,3949153,3946217,3946218,1623247,1116470,1116469,1827853,42636388,36324146,36324147,36332493,35700464,35700463,42636389,621810,834571,834570,37319819,42635605,37319820,42708519,42867952,44966258,45324613,44409191,42708523,42708524,35605107,44428076,35605109,40240666,44408310,40240667,44426066,1113076,44425525,44451460,44446002,44446003,44414568,44417355,36330561,45864465,45209959,44921159,45296217,593117,1583304,45297000,45127186,45246918,45178343,45315265,45198074,45334854,44908903,45317854,44840210,45317855,45232473,45181626,44875229,45301556,45045156,44840564,45028193,45267040,36351073,45148158,44841575,45063209,44986228,3946258,44436578,45151878,42643710,42664317,42664318,42664319,45276766,1113102,44444652,19096798,44410524,45211853,44905380,44412253,44420522,44436912,44442267,44451852,44427314,45333268,1565598,36001867,44991952,44420523,44434074,42796838,37415494,37415495,42822581,42822582,45874699,45864189,44942783,44942784,36175974,36175975,829749,43547672,44781522,44781523,1192247,46253040,46255275,1192221,42826570,44448767,44439200,45177504,45041431,45870086,45874401,45195421,1565599,36001868,44449147,44413608,44419152,44427315,44427316,44421865,44416378,44451853,42796839,37415496,3943629,42822583,42822584,45863871,45874400,45146797,36175976,36175977,829750,43547673,44781524,44781525,1192220,46254313,46249205,1192219,44435096,44437860,45058443,45075540,45315264,45043327,1565600,36001866,44890152,44410916,44425899,44445050,44421866,44436913,44412254,44438217,44420524,42796840,37415493,42822585,42822586,45874155,45872007,44959528,36175978,36175979,829748,43547674,44781520,44781521,19133818,46255769,46253103,1718292,44429645,44421500,44942775,45095901,45903888,45905148,1718294,46251680,46248913,35766386,35770720,35766769,35746865,35772049,35767702,35763556,40725104,35750998,35750997,35758461,35767701,35755249,35750996,35755253,35751000,35772050,35767705,40725105,35751001,35759370,36783353,36783352,36783351,42956984,3963160,19112761,35801782,43035122,36119229,36119231,36119232,36946605,36934294,36945242,36119230,36962110,2934122,45130504,19121580,45284462,44858228,1765164,35110881,43035123,43035124,36944462,36943350,36069291,36926141,36950346,36944593,36069292,36935876,36939204,36940450,36926907,36949804,36923331,36932818,36069293,36938182,36956433,36943179,36069294,36959938,36927854,36119233,36119235,36119236,36119237,36119238,36119234,2075018,2075017,2075016,2075014,2075015)

) I
) C UNION ALL 
SELECT 9 as codeset_id, c.concept_id FROM (select distinct I.concept_id FROM
( 
  select concept_id from @vocabulary_database_schema.CONCEPT where concept_id in (21135988,35161862,35142689,35142078,21155810,21096669,21125997,43769515,43841666,21135871,2031877,2031878,2031879,2031880,21077157,21155692,36896300,44198091,44197706,43775316,43865720,43595441,43667671,43685251,43649273,43832162,43778093,44220938,43830186,43812170,43650398,43686370,43848226,43830498,43686656,36635653,43275671,43291834,43270119,44131574,44131635,44131112,21058267,21176138,21068211,40716270,21068210,44130319,44130389,44130609,44130990,44130388,21048518,21058268,21097582,21097581,21136802,40716271,21117187,21098213,43197689,43142576,43186643,43164740,43042652,21049164,36896040,43593512,43719383,42918693,42918694,43813148,43741209,43724659,43706727,44322889,44848164,36622295,36140216,36571589,41916367,44295718,44583709,21099521,40930340,40961639,21030768,21040643,21050393,21109379,43271708,43260752,43293415,40941336,40878947,41292576,41160199,40855863,44102683,21148589,21089622,21070183,44037928,44112414,41180277,41149178,21100970,21140177,21051868,41292463,41230580,41042724,21150015,41117722,41023663,40930143,41304568,41149177,40855733,40822869,41011635,41117723,41273500,41304567,21100967,21169768,21081309,21150013,40738862,35769727,21032184,40738863,21061669,40738861,21061670,40738859,21100969,21022445,40738858,21150014,40949295,40738860,21100968,41304566,21061671,21061673,21091043,40949294,40980292,41292456,21061672,21169769,21091044,21120475,21061674,41304565,41003382,41315396,44060943,44076707,41159943,40909697,40847597,41191085,43582412,40972030,41136914,40878695,40949303,41034502,41230589,43582413,43213647,43169801,43158931,40823097,41253152,41222191,21140178,21042129,40941075,21159968,40909696,41284147,41323799,41284148,41292455,41315395,41284146,40941073,41253150,41097167,41191084,41315379,41128513,41323798,41097168,41065620,41034501,41042733,41315394,40941074,40917955,41128512,41074063,43271749,43271750,43780406,41065619,40972029,41042732,41065617,41065618,40887051,41284144,41159942,41230588,41284145,41323797,41315393,43600449,40972028,41003381,41222190,41159941,44125584,44050994,41191069,40909695,41065616,40917954,41136913,41284128,40887050,41253151,41230587,41323809,44034851,44128589,42948544,21130238,21100966,21071600,21071599,40738865,21130237,35752984,43582411,21061668,43654630,21042128,44064008,40738866,21120474,40738864,35161252,44089590,41242604,40930137,42948533,41222175,40941050,40980291,41065603,41042723,44086626,44064009,42948534,42948535,44128590,44102609,44076708,41149181,40836816,41054914,41273501,41003385,40941080,41097171,41097172,41097170,40867948,41117720,40824867,41261309,41199515,41323808,41211695,41054911,40930142,40961459,41199516,41136912,40917953,40961458,41117719,41149175,41211696,40917952,41042731,40949302,41273499,43582420,40941071,41230586,41003377,40980301,41159940,41292462,43708473,41097166,41284141,40847593,41168094,41253147,40949301,40972024,41105499,41253146,41191083,40878691,41065611,41034499,40878694,40972023,40941070,41097165,40855740,40941069,41292461,41315391,41003376,40909693,41105498,40972022,41284140,41074062,41315390,40887057,40847592,41065613,41042730,41034500,40855739,41315389,41159939,41284139,41042729,40878693,40980300,41222189,41292460,40972021,41323807,43762319,43798362,21159966,21169762,21061661,21071597,21061662,21140173,21071598,21061660,40738320,21091041,40738321,21150009,40738319,21169761,40867951,40992701,21061657,21071596,21169760,21061659,21140172,21032178,40738324,21140171,40738322,21081306,21140170,40738325,21061658,40738326,21022442,40738323,21110799,21042124,21150011,21081307,21140174,21150010,40738868,21120469,40738869,21032179,40738867,43762320,40847602,40917956,40909700,41230590,41222195,41284149,40980302,43582421,40738334,40738332,40738331,40738333,44034852,44099637,44064010,21032177,21140169,21061655,21061656,21081305,40738329,21051863,40738327,21120468,21130235,40738330,21071595,40738413,21130236,40738328,21150008,41117714,40738836,36814447,41074060,41042726,41199514,40738835,40836811,41149171,41261307,41323803,40949298,41242605,36892759,40738843,36813805,40738842,41149170,40738840,40738841,40738839,41323802,40738837,40887055,40980296,40738838,40867945,44112415,44076706,43744458,40909684,40949297,41065607,41323801,40941055,41168091,43618477,40847579,44076705,40909683,41253139,40917950,40878683,41261306,40909682,41105494,43852570,43726406,41222178,40980295,41222179,41323800,41159920,41011633,43636589,41065606,41128492,40847578,41284129,41230583,41097157,41136908,40941054,40855735,43798360,43255457,43260783,44086625,44076704,43636590,41097155,41105492,41136906,41105491,40980293,41199511,40855734,41199510,41034486,40878682,41105493,40887054,41199513,41292457,40887053,41199512,41230582,40941053,41230581,40847577,41136907,41097156,40980294,40949296,41261305,41042725,40917949,41074059,40887052,41128491,43726407,40738852,40738850,40738849,40738851,35142419,44099636,44064006,44099635,44037854,44047938,44064005,44125583,44089589,40738847,40738848,40738846,43654634,40738844,43636588,40738845,44064007,41894500,44630680,44623180,41085522,40979103,41291287,40979102,40854568,40979101,40929193,41104285,41053973,41166959,41104286,41135698,40916776,41135697,21065416,21035963,21153884,43032966,40729270,21094864,21163691,21153885,40729266,21104741,40729265,21163692,21075359,40729263,36812505,21085078,40729264,40729267,40729268,21045808,36814213,40729269,21055588,21124134,21045809,41022680,41166958,41229380,43179035,40948171,41135696,41198301,41260197,41198300,42939645,44128016,35130902,42939640,42939643,42939642,42939646,43157087,43211786,43134958,43211787,43211788,42939644,42939641,43654337,41250844,40979100,40938636,41260196,40907295,41322620,43726125,43762049,43600173,43600172,43636294,21065417,21065418,21143934,40938635,41000998,40885884,40969686,41166957,40969685,41041544,41157554,41094833,41322619,41313064,41135695,41032084,41135694,43798085,42939639,42939647,21124133,40729274,21104740,40729273,21094862,21134019,40729271,36813955,21173469,40729272,40729275,21035962,43798084,40729276,21124132,36810564,40729770,21163689,21094863,21163690,40866948,36269901,21026164,21055572,36814334,21163685,21124125,21094850,40729771,21045802,40729772,40729774,40729773,21045801,40729775,21035955,36812775,40729776,21085073,21075347,21094849,21143923,40991744,43266787,44076142,43762054,43582147,36275714,36265457,36268747,21055573,21143924,21026165,43288537,43255982,40845203,40938651,44178789,44178788,44175033,41219844,41072809,21173455,36811923,21065408,21094847,21094848,40729777,21173454,40729778,40729780,40729779,21134011,43600178,40729781,21163684,36813873,40729782,21124124,21173456,21065407,21114520,41303657,41303659,42939598,41313092,40969704,41032119,40854569,41918099,43063206,36642820,40897489,40915861,41228478,43146328,40915859,41071922,41022031,36262173,41147609,43201490,41009587,41228477,41022030,40897488,21050456,41084856,40866340,41166064,40915860,41210054,41302993,41124297,41061516,40853718,41030389,41040659,41186926,41103356,41093125,40884949,43854282,41030388,41093124,41124296,41030387,41166063,41093123,43157578,43146330,36275565,36263907,43146329,43190434,36265338,36783373,36276620,21128901,21089670,21089671,21099571,43764030,40999360,41071921,40843463,41134798,40843464,41197420,41030386,40853717,43836349,43710175,41218180,41228476,40936903,41134796,41093122,41134797,40968028,41290395,43782170,41279987,41249183,41228475,40874699,40915858,41061515,41166062,41311329,41197419,43602204,41061514,41259300,41155862,40825342,40947252,41218179,40884948,41134795,41249182,41093121,41228474,41134794,41061513,40978237,40915857,43584171,43638306,43638305,41155861,41259299,41030385,41009585,41186925,41009586,40874698,41166061,43602203,40843462,40968027,41009584,40936902,41228472,41030384,41040658,41249181,41290394,40874697,41228473,43656429,43764029,40936901,40915856,41166060,41290393,41290392,41103355,40884947,41290391,41290390,41103354,41166059,40999359,40947251,40947250,41040657,41009582,41166057,41321704,41290389,40884945,40884944,41009581,41166056,40884943,40915853,41197416,40978235,41155859,41197415,41249179,41093120,41166055,41249178,41030382,40853716,41259298,41071920,40915855,40884946,40853715,41197418,41166058,41259297,41259296,41321705,41071919,41009583,41197417,40915854,40853714,40978236,41311328,41186924,40999358,43656430,36506027,43710174,44101651,40897487,21138805,41084855,40968026,41218177,40843460,40884942,41030380,21050458,21030817,21148652,21148651,40821416,41103357,41040660,41197421,40959849,41009588,40866342,40947253,40978238,40991080,41271855,41228480,41228479,41259301,40843470,41124301,41249186,40843469,36272971,36783374,36266078,43638302,41249185,41186932,41186931,43584167,43656425,40999364,40874700,41279988,43800055,43854280,43800056,43656424,41116101,40947269,41197431,43135454,40853728,40978248,41053297,40959853,41210056,40835202,41071931,40915871,41147611,36277524,21168393,41116099,41271858,41116100,40884962,40884961,41084860,41178642,41271859,42934721,42934743,42934709,42934744,42934720,42934710,42934745,41279999,41311337,40947268,41311335,40915870,40843477,40884960,41311336,41166072,43764027,42934734,42934746,42934711,42934712,42934735,42934722,42934747,42934723,42934748,42934713,42934724,42934725,42934726,42934736,42934737,42934727,42934728,42934749,42934714,42934739,42934738,42934715,42934708,42934740,42934716,42934729,41030399,41218189,41249195,40884959,41279998,40874709,40999372,40978247,40968036,41124307,43157579,43135456,36272972,36266434,43179535,43135455,21050459,21099576,21119123,21021100,42934705,42934707,43800057,40874708,41197430,41218188,41009599,40874707,40915869,41155871,41071930,43674559,43584168,41186939,40884958,40874706,41134803,40843476,41040669,40936917,40978246,43602199,40905635,41218187,40947267,40968035,41071929,41030398,41321709,41155870,40915868,43620191,40936916,41040668,40968034,41259308,41228489,41218186,40884957,41259309,41061519,40999371,40947266,41155869,41009598,41009597,43746119,43836347,43602200,41124306,40947265,40936915,40853727,41093136,40915867,40999370,41103367,43638304,42934750,42934741,42934717,42934730,42934751,42934718,42934753,42934731,42934706,40874705,40843475,41259307,41030397,41103366,41124305,40915866,41249193,41071928,40999369,41259306,43818169,42934719,42934732,42934733,42934742,42934754,43764028,41249192,41103365,41228488,44174817,40853726,41228487,41040667,41259305,40978245,41103364,41103363,41197429,41134802,40884956,41134801,40947264,41009596,40884955,41290401,40874704,40947262,41009592,41259304,44159802,41166071,40884954,40947261,41228486,41103362,41166070,40947260,40853724,40978243,41290397,41134800,40853723,41009591,40915864,41166069,41228485,41155868,41311333,41061518,41249191,41071927,41321708,40947263,44182292,40915865,41040666,40978244,41071926,41197428,41290400,41197427,40822226,41040665,41009593,41009595,41009594,41321707,41290399,41290398,40853725,40905634,41279997,40853722,41186937,41093135,41249190,40874703,43674558,43710172,44114493,41053296,41040664,41259303,41084859,40853721,41166068,41271856,40959851,40991081,41178639,40959852,40978242,40947258,41210055,40866344,40835201,41228483,41134799,40959850,40821728,41093134,40843474,40947257,41124303,41228482,41155867,40884953,40999367,40947256,43764024,43746117,40905633,40825654,40905632,40947255,41093133,41166067,41030396,41009590,43728187,40936914,40968032,41290396,41218185,41103361,41030395,40947254,41030394,41197426,43836346,40843473,40915863,40936912,41197425,41040663,40936913,40978241,40978240,40936911,36419768,41249189,41103360,41103359,43818168,43656423,43764023,41279993,41197424,41155866,41071923,41311332,41259302,41093132,41321706,43836345,41249188,40874701,40822536,40936910,41009589,40999366,41103358,40843472,41197423,43854277,43710171,40905631,41040662,41228481,40853720,40905630,40884952,41093131,40968031,41279990,41124302,41279991,41040661,40978239,41166065,41186934,40843471,41166066,41030393,41186933,43854278,43818167,36619369,44596395,35881035,42075081,41887978,35754167,35749963,35749964,35754792,35750567,35754791,35763122,35767212,35745111,35761826,21060312,40927816,43135159,43028397,43028396,21109451,43201206,43212007,43190129,21079977,21158620,41070699,40997181,41070700,41216055,40852473,21168420,41289136,40934706,40965865,44167035,41247088,44185762,41289134,43190130,43157320,43201207,43190131,43146043,43157321,43135160,43146044,43135161,43157322,43157323,43201208,43295298,43257282,43262690,43279073,44047020,44127187,44049595,44114044,41177852,41052520,41320464,40959100,41133476,40990347,40914643,41028238,41028237,40934702,41122172,41122171,40965858,40872473,43673358,35745782,35766596,35746406,35771554,35774483,35746405,35749308,35770221,40834505,41115349,40914651,41133484,36881885,41258019,41102124,40976977,40946034,43146045,41133483,43028405,43028402,43028404,43028401,40883725,41039424,43028399,41070703,43028403,43028400,43028398,41146904,40834504,41177853,41289138,40883724,41102125,41196153,43179243,43146046,43146047,43135165,43135166,43691185,40965866,40946033,40872484,40976976,41153711,41320473,40841302,41320472,43619036,36888965,40872483,40946032,41184741,40883723,41277919,41070702,41091042,41216058,41070701,40841301,41039423,43726988,43190132,43157327,43190133,43190134,43135167,43212009,43135168,43146048,43146049,43179244,43179245,43168179,43168180,43157328,43212010,43135169,43157329,43146050,43168181,43190135,43168182,43179246,43135170,43135171,43212011,43135172,43168183,40841300,40841299,41028243,41247089,41184738,41184740,41091041,41008338,40903495,40976975,40934708,41320471,41184739,41289137,43745024,43762893,43853169,41184737,40903494,41164803,41216057,40976974,41216056,41227225,43582989,40934707,40852474,40903493,40946031,41059454,40914650,43691184,43762892,35758283,35758282,35746404,35758904,35758903,35758902,35774481,35746403,35774482,35761825,40865638,41209363,21021127,41196151,41227222,41320469,41320468,41039421,41258016,40990350,41146903,40865637,41115348,40852472,41227223,41289133,41289132,41320470,41102123,40990351,43211998,43028395,43028391,43028393,43028390,40852471,43028388,41133481,43028392,43028389,43028387,41209362,41008337,41070698,41133480,41102122,41039422,41258017,41115347,41084122,43257283,41115346,41052522,40865636,44060036,44101192,44033994,44114047,43179239,43157313,43135158,43816993,41028242,41133479,41153710,40976973,40934705,40946030,43637145,21050487,41153709,21060314,41008336,40872482,41277918,41184736,41070697,40965863,41289131,40965864,40824087,40903491,40946029,41309142,40997180,43673357,44075329,41091040,41277917,40872481,40965862,41277916,41008335,41247087,40965859,40903488,44185763,41102120,40903489,40883720,40883721,43157314,43211999,43179240,43190126,43212000,43201201,43146034,43212001,43201202,43157315,43146035,43179241,43168178,43146036,43146037,43190127,43157316,43201203,43157317,43157318,43201204,43726989,43146038,43146039,43179242,43146040,43212002,43157319,44049597,43212003,43212004,43146041,43273663,43289864,40965860,40903490,40872480,41039420,41028241,41277915,40914648,40841298,40997179,41059452,41309141,40946028,40934704,40914649,41216053,40965861,41008334,43726991,41122175,41216052,40841297,41216051,40872477,41309140,43619037,43619038,40841296,40841295,41122174,41277914,40997178,41247086,41289130,41091038,41196150,40872479,41070696,43709047,40841294,41164801,41122173,41039419,41247085,41102121,43726990,43289863,43284468,41153708,41091037,41184735,40946027,41184734,41059451,41258015,44072825,44101191,44036462,43709045,44088198,44101193,41115344,41196148,40914646,44045301,41052521,41289129,40865635,41021304,21070277,41227221,41289128,44072824,44062626,43781033,41091036,41008333,41309139,40976971,43835207,21089695,40934703,40852469,41277913,41102119,21109448,41258014,43691186,44111485,44114046,44124684,44114045,43816992,43709042,43835206,40841293,41102118,41309138,40821591,40997177,41008332,43673355,40841292,40872475,41320466,41153706,43798929,44049596,44062627,36589557,36574794,36575940,36591438,41919734,41920177,36638904,36339731,1507735,45367581,1507736,43063207,19076136,45040416,36342146,45380632,45279767,45196086,44906971,36398453,1190049,36398440,1190048,45241865,40173366,1518851,1518872,45111085,1518258,45025886,36177448,36117577,36926247,36063793,36920373,36063789,36063792,36939301,36963503,36063791,36063790,35897728,19006962,42841190,36928290,35886837,36951285,35886838,36926388,36961815,36063796,36965011,36940164,36063795,36063794,35897729,2055918,35519965,19095136,35519966,35519967,35519968,45178997,45280078,44922136,44957618,45074639,45262303,44972223,44853135,45864159,36381277,36898435,42829920,42829921,42829922,42829923,42829924,44865910,36177449,36117579,44917195,44984884,45053181,45070323,44918728,44986416,45276584,2055910,2055911,2055912,2055913,2055914,42841191,19095151,2055908,2055909,43559087,1518259,1753240,1753241,42508526,45042925,45281787,45254678,19076135,44957615,19029973,46331657,19018906,46331565,44906999,707988,36479320,42644298,1105285,45040473,45228114,45364496,3954110,3954111,36873186,45298951,45196093,593652,46329976,46331298,19030001,3963935,3963936,3963937,1518261,35198633,44439630,44412316,44427380,44410975,44439631,44957628,37300408,45023596,45040658,45125614,711298,44906982,43559088,45068073,45361633,35897725,36923428,36922865,36928331,36933427,36930334,35897726,36920488,36952164,36063787,35886835,35897727,36920977,36954599,36063788,35886836,37497612,43553165,37499312,43553166,3963938,1518292,35198632,35198631,35198630,35198629,36134574,36348278,45865388,45125418,45040458,45057459,45193639,45228105,45091529,44955220,45869581,45867460,36874444,36318386,36479029,36480712,36479419,36478884,750519,750520,750521,1743536,42631340,35301159,42631339,3961659,3961660,3961661,3961662,45332870,45074840,44955453,45262516,45279575,45211126,44853325,45159658,45262517,45262518,44972434,45296701,45091734,44989848,45006914,45041201,45365178,45075316,45331118,46249118,45229149,622753,622754,622755,622756,1997768,1997767,1997766,1997765,35402799,44438277,42508527,35403040,35402660,35403045,35402887,35899015,35300196,36873187,835133,36873188,1228258,1228259,45025887,36391536,35109914,1997774,1997773,1997772,1997771,1997770,1997769,35520208,42519795,42830567,42830568,42830569,42830570,42830571,42830572,42830573,42830574,42830575,42830576,622752,36101601,635419,42654843,36177450,1225182,36380334,36117574,42635592,36117575,36117576,45054653,45327604,45225228,36134573,44969313,45156666,44983548,44781114,43553167,36321554,45329085,1779662,1779695,1779504,1143984,44900138,45223738,44882996,45240827,35519344,44865876,44951055,45275113,1565739,45903528,45902858,45904822,45903198,45053204,834599,45863321,45905101,45037500,44884696,36063778,36063779,36063783,36063780,36063782,36063781,36959910,35886833,19030003,42841192,35886831,35886830,35886832,19030005,2055905,2055906,36063784,36063786,36063785,36945338,35886834,3970500,3963939,3970499,1518293,1228260,1228261,1228262,36134575,3950484,3953184,45315934,35524856,35524857,36318872,3954112,36350971,36350972,36873189,44923880,1228263,36177451,36117578,1779564,19030008,42841193,3963940,37003052,36392476,37003058,35896827,35896826,35896828,37003060,36392473,37003062,35896824,35896823,35896825,975168,36401802,45092822,44871391,1229116,35838002,36392466,36997884,43547708,36106549,1984019,44432852,36137270,36182336,36182337,35531084,1984200,45275510,44446430,35110408,3942580,36345064,708055,44914918,45033893,45135830,44851867,36056995,36056994,36923960,36056993,35885559,36056991,36056992,2034613,2034614,2034615,19039383,45161666,1623973,1626306,2034616,2034617,2034618,2034619,2034620,2034621,2034622,2034623,2034624,2034625,2034626,2034628,2034629,2034630,19006964,36934763,36950359,36922285,36057001,36056999,36057000,36057002,2034631,2034632,2034633,2034634,2034635,2034636,2034638,2034637,36056998,36056997,2034607,36926436,2034608,2034609,2034610,2034611,35885560,36056996,2034612,37003064,36392475,37003066,35896821,35896820,35896822,975169,36381313,36339843,36392474,45128501,37317437,44432853,35403425,35403415,36975475,1984422,36137271,45258409,44445037,44999581,3942471,36345065,726321,708059,45039299,36056900,36056982,35885557,36967944,36056981,2935779,19039743,45076792,19006965,36941291,36967963,36929828,36056988,36056986,36056987,36056989,36056985,2034605,36056984,35885558,36954843,2935780,36056983,37003067,36392477,37003069,35896818,35896817,35896819,975193,36401803,36392478,1544498,1544499,1544500,1630326,1630327,1630328,1630329,1630330,1630331,36348510,36348511,36348512,1190118,1627360,1627361,1627362,1983869,1627363,1627364,1627365,45863356,45873877,35402786,1528962,1528963,43559392,44424652,36137272,45036557,44424533,35110411,3942715,36345066,708060,44970989,36948957,36927393,36919474,36925205,36924045,36942614,19039286,44855260,36946933,36945022,36928948,36930476,36955689,36415111,1506479,36415110,42644655,42647427,36181031,36181032,36181033,36181034,36181035,36179874,36179875,36179876,36179877,36179878,45107359,45363328,19034647,45213067,1506312,42644656,19034645,44940605,2057340,2057341,1506314,36415109,42644657,42647426,36181036,36181037,36181038,36181039,36181040,36179879,36179880,36179881,36179882,36179883,45346305,44937310,19034650,45127552,1506426,36415107,36415106,45331714,44939720,824374,42644658,829828,36179449,1171803,45331206,37400086,36342545,42647425,37300309,37317631,36181023,36181024,36181025,45074628,1997601,45195272,35531217,37300308,37400085,36179866,36179867,45352627,36181242,45216539,36184254,44949070,44863824,45034121,45341128,44892998,45175417,44850227,45088662,36197981,36415108,708115,1583376,44966467,1225919,1565775,36178379,35506089,44903306,45005038,2057293,2012257,2057295,2057294,2057296,2057297,2012258,2012259,2057298,2057299,2057300,2057301,2012260,2012261,2057302,2057303,2057304,2057305,2057286,2057306,2057307,2057308,2057309,2057285,2057310,2057311,2057313,2057314,2057315,2057317,2057318,2057319,19067555,45247262,45863686,2057321,2057320,2012262,2012263,2057322,2057323,35866484,2057287,2057288,2057289,2057290,2057291,2057292,36301967,36301968,1506315,36415105,42644660,42647424,36181026,36181027,36181028,36181029,36181030,36179869,36179870,36179871,36179872,36179873,45107358,45329274,44851853,19034646,44940606,1550775,35108589,45253560,45041046,44907575,44924448,834195,44933001,43135141,21168398,19122782,44940151,19067795,44437548,44124685,21138808,21060296,1550719,43146013,43135142,21138807,1551010,37315161,44420661,35405587,45901010,1551046,37315092,37315093,45175308,1551042,37315162,44443798,35406082,45901345,1551045,44433682,37315094,37315095,45022057,1551093,45265329,44435179,44164822,43834621,43852582,45868545,19130001,19106652,40990358,40914661,40883738,41258027,41008351,41196159,41289144,41302312,41070712,41289142,40946040,41070711,40852481,41289141,41209375,41102134,43024882,43024879,43024881,43024878,40976990,40914660,41289143,40883737,43024876,41008350,43024880,43024877,43024875,41115362,40749534,40749533,36063367,40749532,36966541,21079975,40927823,41227235,40883736,41320475,40914659,40883735,40821900,41091071,41122201,40883734,41059475,41227233,40965889,41227234,40841325,41196158,41153742,41216081,41289140,40903520,41227232,41091070,44178305,41153741,40976989,40872512,40883733,43780419,43618485,40934732,40976988,40997207,41227231,41247113,41258026,41309169,41133490,43816410,21050482,21060309,21138828,21070275,41184767,41216080,41164808,41309167,41008349,40821166,40824712,41309168,41164807,41028264,40997206,40825022,41277941,41008348,40872511,41133489,41309166,41227230,43600471,43600474,40997205,40976987,40965888,41102133,41309165,41227229,40872510,40883732,43618484,43672766,43852579,43744475,40872509,41196157,40997204,41008347,40965887,41102132,41216079,40852480,43798371,43582431,41028263,40883731,43582432,41309164,40872508,41258025,40997202,41039429,40997203,41102131,41059474,41133488,43672765,41277940,41102130,41091068,41164806,41122200,41070710,41091069,41008346,43600472,40244439,43024883,43024884,43024885,40749536,36063368,40749535,43690615,36939542,43708485,19070310,44937489,46250157,45865700,35909181,46255618,42797607,45210869,44973462,46252002,35198286,35198285,45216039,45198868,44941349,44445231,46250584,44887739,44887740,45367499,36180082,36668974,37299188,45185981,3954523,45288114,44412684,759238,44427766,44913236,37000178,37000177,37000176,44461233,44462102,1230287,43052071,43052072,44465622,45188092,45171074,45205192,44466598,44915990,45121267,45242464,40226713,1550720,19128780,19129883,45086684,19131603,45291651,45188814,42970581,2054973,1551044,37315163,44434205,35406147,45904321,19125148,37315096,37315097,45226829,19126169,36180177,42636953,44975230,44446107,790380,1551098,45870697,1550560,36355854,45249935,3946570,3946571,41115364,41302313,21089681,41320483,40914664,21099590,41289145,41039433,41164812,41133491,40976997,21128914,21099591,21021111,21089682,41084133,41052531,40927825,41115363,40914666,41102141,41008356,41102140,41320486,40852489,40914665,41320485,40896811,21119132,21158600,35886730,21168403,21040707,21099589,35753476,21070253,36939512,21021110,21138813,21138814,21099587,40749440,21099588,21040706,35886729,40749442,21158599,36921518,35886731,40749441,21148661,21060299,21030821,21158601,40749435,40749432,35897670,40749431,40749436,40749434,40749438,40852488,35897669,40749433,36063371,40749439,40749437,43024862,41209377,41039434,41196163,41008355,41196162,41289146,41196161,41227240,41320484,41177865,41102139,41209376,43289858,41084132,40927824,1550975,41059482,40965897,40976996,40872517,40852487,41277946,41039432,40997214,40872516,40841332,41320482,41247118,41153749,40965896,40946043,41184774,40852486,41216089,41070717,41091075,40883742,41309175,41309174,43654656,41059481,41153747,40852485,40934740,41153748,41008354,41184773,43726416,41153746,41320480,41216088,40976995,41216087,41320481,43726417,40841331,40872515,41039431,41028271,40883741,40934739,41070716,41277945,41008353,41122205,41184772,41184771,41059480,41258029,41028270,41258028,41122204,41309173,41070715,41028269,40903527,40852484,41309172,41196160,40965895,41184770,41091074,40872514,41059479,36502088,19132464,45874982,44427434,44446543,44072828,44062629,40965892,40823035,41070714,41028265,40883740,43762332,43273660,43289859,21030822,21119133,21119134,21040708,19007005,41277944,41247117,40946042,41309171,41164811,40841330,41227239,40824287,41028268,41320479,40997212,40914663,40903526,40997213,41028267,40965894,41122202,41102138,41059478,41122203,40946041,40934738,41008352,40903525,41164810,43672772,40965893,41216086,41153745,43600478,40903524,40914662,41309170,40852483,41028266,41320478,43654657,43798374,43672773,43816419,40934737,41320477,40841329,40852482,41277943,40976994,41216085,40976993,43654655,43816418,40903523,41227238,43834632,41247116,40903522,41164809,40997211,41227237,41091073,41184769,40997210,41039430,41277942,41102137,41247115,41102136,40934736,40872513,41320476,40997209,40976992,41184768,40825955,41247114,41102135,43762331,41216084,40976991,40934734,41227236,41091072,40883739,43636600,40244441,19113764,43024864,43024814,40903521,40965890,40934733,41216083,41070713,40841327,43268146,43295291,19001447,40997208,40841326,41059476,41216082,41153743,21099586,40749443,21158598,21128912,21148660,35765905,21050465,21148659,36965710,21138811,21158597,21128913,40749446,43708491,21070251,40749444,21060298,21070252,43636599,40749448,21040705,36950219,40749449,40749445,40749447,21168402,21089680,21138812,19061583,44907817,45060872,3954524,43052073,43289862,19128781,43262689,42873627,45383395,42873628,45383396,45093354,1551100,1779593,44855596,824551,829994,829995,45213373,44991537,37513962,36342617,36342618,1782686,1782685,633899,36115353,1766139,790378,790377,973555,973556,1508648,1508647,36188059,36188060,36188061,36188062,36188063,36188064,36188065,36188066,36188067,36188068,36188069,36188070,36188071,36188072,36188073,36188074,36188075,36351346,3946579,3946580,43554849,43554850,44875335,45011434,595843,45086804,36101892,1116259,1116258,1116257,44987986,45380440,19024533,19033379,19033380,45349954,1551193,45077075,45230626,44873822,44430458,19031623,42825910,1551101,43559626,37618292,43559627,43559628,42841969,36143475,36143474,44442324,44438268,44424600,44435566,44410976,35601853,1997225,45194627,45041498,36999189,36999190,729687,2997904,2997903,46251941,46252883,44432788,46329754,46255101,46255561,45867566,46253818,46332686,35906539,36143482,36143481,36143480,36143479,36143478,36143477,36143476,36179296,36179297,36179298,36179299,36179300,46364768,46364987,44923858,45315901,45196071,44420584,44417827,42826469,44413656,44446498,44412318,36178888,36497887,36109685,44438269,44439632,44434125,44412319,45280173,44904383,45176531,45210854,45091465,45176532,45159394,44887228,44904384,45125364,45245069,35999807,45859211,45871829,829986,829987,829988,1187888,1358249,42636612,36502092,36502093,600332,37317716,1108049,36773786,44852234,42825990,36179657,36181467,36181468,36181469,36181470,36181471,36181472,36181473,36181474,36181475,36181476,1230294,1230295,824550,35999809,1230296,1230297,35999810,1835965,35999811,45125502,1829458,1829459,1829460,1829461,1829462,1829463,1829464,1829465,1829466,1829467,42827484,725893,725892,725891,633897,633898,1768573,45905113,45164935,44438698,44448244,44445499,44411412,44409995,44409996,44423661,44436018,44430493,36115297,36115294,36115358,36115368,3961894,3961895,3961896,3961897,3961898,3961899,3961900,3961901,3961902,3961903,3961904,3961905,3961906,3961907,3961908,3961909,36873581,35198284,37400235,36345293,45143094,42517192,35531328,37520174,44432916,46251469,1104893,750865,36918679,42831530,42831531,42831532,42831533,42831534,42831535,42831536,42831537,42831538,42831539,36999191,36999192,1996956,1996957,1996958,1996959,1996960,1996961,1996962,1996963,1996964,1996965,42517193,36324268,36324269,36324270,36324271,36324272,36324273,36324274,36324275,982215,982214,982213,973553,973554,36353960,42832324,42832325,42832326,42832327,42832328,42832329,42832330,42832331,42832332,42832333,45297173,44972954,45092221,45382317,45263012,45177298,583516,583517,36502089,36502090,36502091,45321169,44895033,45218595,45270059,800684,1230289,1721387,1230290,1230291,1230292,35999808,42885460,1230293,36097256,36097257,36097258,36097259,36097260,36332579,36006997,36006998,36006999,1997224,36348866,36189164,36181075,36181076,1997223,36187854,44410214,36666179,42868168,37294676,42868169,42636613,1984284,36143668,42868170,37520175,36097255,42868171,36898298,42868172,37289799,37289800,790379,35700061,35528234,36351344,36351345,42885456,42885457,1162778,35909182,1162779,42885458,42885459,45077738,44924529,46364805,44847361,44966449,45324801,45239497,45136775,45239498,45865477,45256623,45145485,45299587,3946576,3946577,3946578,45066942,45339839,44896813,44445321,44424833,44460838,35531327,3951252,45257932,44900093,45343088,45326111,45206516,45138111,45155195,45121215,45138112,45223691,42847385,45254693,829989,829990,829991,1799238,42636952,829992,1799237,829993,45359334,43554847,43554848,45189305,44917163,44848707,45240772,44934146,44967770,45138110,45001874,44934147,829982,829983,829984,1234030,1234031,36177691,1234032,1234033,1234034,1234035,45198831,45335588,44960292,45233289,45113844,45181725,44466771,44465913,44465061,44465914,44465915,44463345,44464199,46253354,35700068,35700067,35700066,35700065,35700064,35700063,35700062,36143301,36101891,45235877,45252903,45218612,3946574,3946575,1530052,36177238,1372894,36177239,36183973,37602091,36177240,36183974,36177241,35518888,1565691,42825140,42825141,42825142,42825143,42825144,35525324,35525325,35525326,35525327,35525328,35525329,35525330,35525331,1226046,1226047,1226048,46358479,45376660,36401978,46347963,45871830,36401979,3946573,824548,824549,44411930,44421539,44446044,44413255,44417401,44436570,44429676,44464746,44466430,36999188,36342616,36177122,3951251,3946572,35405690,46250992,46250991,46252413,46248700,44410306,45054526,44466790,44462416,1782687,44425421,45243851,44970846,45380310,45141007,42631184,998679,998678,998677,44901854,44884719,45139755,45174044,45310820,45192457,45124267,44970977,36393238,19034203,19034204,19098197,19113791,19034205,36302020,3970978,3970979,42873629,45298239,42873630,45093355,45144155,1551122,45094011,1541337,829996,36115330,36115283,45196100,37513963,42517197,973560,982212,36351350,1219717,1219718,600334,600335,3946584,44460498,45066997,43554855,45233288,45223742,36999199,3961912,36101877,998669,998668,19033622,708160,708161,1551170,43559629,43559630,35525334,40248352,35525335,43052074,46251584,44420573,44421915,45864041,46254808,45872396,46255674,46332347,45870270,36128751,36092643,1226058,36348868,36348869,36348870,36348871,36348872,36348873,36348874,36348875,45075618,44854092,36009247,37409476,45056610,44988280,44411600,36187605,585577,36867782,36867783,1792660,1792659,36321711,1578481,824558,36109686,35531329,1562494,43554853,42647441,36178762,36178763,36867780,36867781,36179301,36179302,36179303,36179304,36348867,46365355,46364660,35906540,35906541,35906542,35909184,35110755,35110756,1626240,44957599,45298936,45077055,45347383,44955164,45262224,45245072,45210855,45142281,44853055,45125366,820194,593912,36666182,36666183,36666184,36666185,36666186,36666187,36666188,36666189,36666190,1743247,1996966,36999197,1996967,1996968,1996969,1743246,1996970,1996971,998671,998670,36873583,3951260,1162780,36348876,1162781,45043540,44958262,45043541,1162784,1162785,1753522,1753523,1753524,1753525,1753526,1753527,1753528,1753529,1753530,1753531,1753532,1753533,1753534,42647440,43554854,1748848,36006991,36006992,1230298,36198302,36198303,36198304,36198305,36198306,36198307,36198308,36198309,36198310,36198311,1789132,35304893,36381990,36381991,36381992,36381993,36381994,36381995,36381996,36381997,36381998,36381999,45746890,1226060,1226061,1226062,1226063,36143667,36143666,37000175,42631183,42631182,45228189,633900,1364062,37317717,1799234,36702166,36397389,1358250,1358251,1358252,1358253,42644742,36999198,37289803,42644743,42644744,42644745,42644746,42644747,44443758,44408253,44436998,44430117,44442351,44419237,44427418,35528236,44416489,42847387,44419238,44436999,44449228,44421963,44445124,44446528,35906545,834196,998672,35198282,1835966,46332557,44445196,44417939,35198283,973559,45870271,46249264,1105612,36699267,45872397,35531330,45866055,35518212,1230299,36115336,36115194,36115389,36115268,45864040,36699268,35909185,1364061,36353967,36999195,36381426,36999196,42517194,42517195,42517196,3954525,3954526,3954527,3954528,3954529,3954530,3954531,45010825,45028032,593913,42636951,1226059,973557,973558,37496345,37496346,37496347,37496348,37496349,37496350,37496351,37496352,37496353,1766140,36355857,45228855,45331139,45211640,44939211,44887986,45109302,583518,583519,583520,35999812,3946583,36974085,45382590,44431544,44438382,44441084,44437098,42827233,45143096,42827234,44973013,44946109,36340093,36340094,36340095,36340096,36340097,36340098,36340099,36340100,36340101,36340102,36340103,36873584,36873585,36873586,36873587,36873588,36873589,36873590,36101894,36348877,42885461,42885462,42885463,42885464,42885465,42885466,35110757,600333,36097261,36097262,36097263,36097264,36097265,1997222,1997221,1997220,1997219,1997218,1997217,36181077,769754,36187855,36181078,769755,36181079,44413360,44416126,44439321,44448903,44409275,44440649,44437984,44428418,44414714,44446167,44435224,44451596,42828900,35110768,35110769,35110770,35110771,35110772,35110773,35110774,35110775,35110776,35110777,37289801,37289802,44412242,44443660,45222373,35531333,35531334,35531335,35909186,35110766,35110767,36351347,36351348,36351349,42833170,42833171,42833172,42833173,42833174,42833175,42833176,42833177,42833178,42833179,1219711,1219712,1219713,1219714,1219715,1219716,1996972,44890398,45282466,44839027,1996973,1996974,1996975,1996976,1996977,1996978,1996979,1996980,1996981,1996982,36092641,36092642,623140,623141,623142,623143,623144,623145,623146,37502115,36355856,37502116,45322820,45271701,44896814,45373857,44879609,44433016,44445322,45036076,44865824,36196642,45240773,44917164,45343089,44848708,44934149,45257934,45206517,44934150,45292145,45292146,824557,45861877,45864043,45859767,45870273,45101917,44462450,35519064,35519065,35519066,44465952,36009246,36324276,43554851,43554852,36353966,36355855,44451578,46330726,44435214,44429751,44424290,46331797,44448890,44417484,44429752,44781706,623137,623138,623139,45284444,44926449,44858204,45216089,45250308,45216090,45238580,45137004,46248820,45338226,44996830,45099271,45287102,44877958,46365852,45222374,44864569,45307796,44864570,36177765,1829468,36873582,1829469,1829470,36177767,998676,35519101,36177768,35519102,36868063,36868062,36999193,36999194,750867,44998593,44998594,1529106,1529107,1529108,1529109,1529110,824552,824553,824554,824555,824556,3946581,44422868,44443293,44410551,44444679,44439220,44462300,44464106,44464962,44460587,44463239,44461437,1627061,45902965,46251104,45904903,45903932,45903303,45900633,45905201,45225093,1799236,1799235,45052632,3946582,36353961,36397390,36101893,36353962,36353963,36353964,36353965,3961910,35801713,3961911,45310840,35909183,42825152,42825153,42825154,42825155,42825156,42825157,1226049,1226050,1226051,1226052,45158166,44920130,45295223,1226053,1226054,1226055,1226056,1226057,998675,998674,998673,45022150,45022151,44920267,19034231,46339988,35528237,19034232,19098198,19113806,3964333,1733464,1733465,36302021,3970980,1733462,1733463,1733461,42873631,45366224,42873632,44940232,45110375,1551192,1779658,1779648,1779674,1779578,44414990,44449197,44412303,44450528,44447809,44409555,44427365,45870275,44409556,44419197,44427366,44427367,36006873,35519641,35519642,45859770,45872399,36496644,45162008,1230301,46365470,46365052,1116256,36143665,35531336,35531337,35531338,45866057,45872400,44438393,829997,829998,829999,830000,45230630,45025892,36118251,1141986,1799233,1799232,1799231,1799230,1799229,1799228,42647437,42647436,44428500,35531339,36198315,36198316,36198317,36198318,36198319,36198320,36198321,36198322,36198323,36198324,1230302,36393241,36393242,36393243,36393244,36393245,36393246,36393247,36393248,36393249,36393250,45058285,36348898,42825935,42825936,42825937,42847390,42847391,42847392,42847393,42847394,42847395,42847396,42847397,42847398,42847399,42847400,42847401,42847402,42847403,42847404,42847405,1743245,1743244,42647439,42647438,45903304,36342619,36342620,44904522,35528239,36198313,45245075,45210857,44870054,44887236,44955166,44921386,44921387,45210858,45364425,45091470,633902,633903,45747329,44420691,36109687,36601667,1829471,45872401,45331523,36115318,36115296,36115332,44419081,44438143,42517199,42517200,36918680,1627555,1627556,1627557,1627558,1627559,1627560,1627561,1627562,1627563,1627564,36868061,36868060,36868059,36868058,36868057,36868056,36868055,36868054,36868053,36868052,35198281,36393251,36502094,42833524,45198259,35906546,35906547,35906548,35906549,35906550,35906551,35906552,35906553,35906554,35906555,973562,973563,45126135,45041223,45126136,45109303,45365199,45314202,45365200,36179308,1562495,1562496,35999813,1366826,42631181,1366825,759240,36415037,42832601,42832602,42832603,42832604,42832605,42832606,42832607,42832608,42832609,42832610,2519324,36097266,36097267,36097268,44425086,44414086,44415484,44445541,44430531,44426435,36181082,37415680,37415681,37415682,37415683,37415684,37415685,35110591,35110592,35110593,35110594,35110595,35110596,35110597,35110598,35110599,35110600,44451131,37289814,37289815,790375,37098341,37000174,44425888,44424536,1768574,45903933,45267544,1997216,1997215,36351352,36351353,37289816,37289817,36393240,1162787,36118252,36118253,36118254,36118255,36118256,36118257,36118258,36118259,36118260,45103593,45291615,44924530,45316582,44941551,44873136,3946585,3946586,35204703,729690,35204704,45203175,45339838,44845368,45203176,45220367,708163,46364803,44435800,43554857,43554858,44892425,44977269,44880740,36118248,36118249,36118250,36351354,44926543,45284528,44999654,42664481,45103024,45359193,36135027,36135028,36135029,36135030,36135031,36135032,36999200,36177121,35500062,44465890,44464185,44463316,44465891,44460659,44463317,1779636,44431133,44447531,36009249,36177776,36009250,36009251,36009252,35519106,35519107,1627062,35406099,46252062,46255678,46250658,46251585,44432137,44847355,44983543,44986243,35525336,35525337,35525338,45138120,45155204,44934157,45377235,42824916,45377236,45326121,45053158,45206533,45121225,42824991,36353969,44886015,44851693,45242526,998665,998664,998663,45278170,45039296,45122894,1971536,19007010,19034011,19024534,19034012,19034013,1551234,19034014,45298949,19028933,19121838,36973277,1551123,1230300,36348878,36348879,36348880,36348881,45364513,45159483,44955253,44921495,45125444,44409827,36198312,45247519,45161971,37400234,600336,600337,36975588,36975589,36975590,36975591,36975592,36975593,36975594,35405888,36348882,36181099,36106914,46254257,36104698,46255562,46249152,46255102,46253355,46250531,46253820,46248701,36496839,36381955,36381956,36381957,36381958,36381959,36381960,36381961,42517198,790376,35110778,35110779,1530051,35110780,35110781,35110782,973561,36348883,36348884,36348885,36348886,36348887,36348888,36348889,36348890,36348891,36348892,36348893,36348894,36348895,36348896,36348897,834450,834449,834448,834447,834446,834445,834444,44434268,44412442,36978123,35300485,35300484,35300483,35300482,35300481,35300480,35300479,35300478,44423867,44410213,36353968,36351351,36401980,36401981,3961913,3951262,3951263,633901,43554856,44967857,45155299,44409205,45136806,35700060,44433712,45105673,44901608,45037636,3951261,45361634,998667,998666,19034327,19034328,708162,43069857,19130122,19129289,19130165,19130164,19131653,793639,36186643,19135172,37512163,19135275,45231074,1366731,35505867,964312,750186,37317082,42840562,800449,40171334,793636,45008348,19133854,45903896,19129398,46249834,42508799,45862293,1358183,44973383,42644659,35999751,829829,1229779,1171804,36340011,36340012,36340013,36340014,44435596,36097151,45113721,43554686,37300307,44447663,37601892,35700105,36998928,36179868,44909680,44879605,42885290,45052789,45257930,44892997,42646784,35527643,44920293,45171256,36177666,1724104,45273731,1565776,45005075,45175400,42707634,45860862,40227495,19135075,829985,19129514,1185267,44443302,44432217,45130580,44933086,19135073,45193667,19129512,1372895,1185268,44429500,45369575,45207651,44435124,45054802,37003556,37620391,37003557,19133985,1592182,35505868,1366732,42644487,19129290,36186644,19130269,44958107,40171336,37408718,1511403,36008566,1511404,35904803,1592183,45871115,40225702,40225703,19135074,750866,19129513,1185278,44408996,45267509,19135072,1185279,19129511,44429501,45318673,793640,792331,750229,964311,42840710,42644488,793637,36186645,19129254,45162441,19130270,40171343,19130171,19130170,19130167,19130166)

) I
) C UNION ALL 
SELECT 10 as codeset_id, c.concept_id FROM (select distinct I.concept_id FROM
( 
  select concept_id from @vocabulary_database_schema.CONCEPT where concept_id in (21603252,21603255)
UNION  select c.concept_id
  from @vocabulary_database_schema.CONCEPT c
  join @vocabulary_database_schema.CONCEPT_ANCESTOR ca on c.concept_id = ca.descendant_concept_id
  and ca.ancestor_concept_id in (21603252,21603255)
  and c.invalid_reason is null

) I
) C UNION ALL 
SELECT 11 as codeset_id, c.concept_id FROM (select distinct I.concept_id FROM
( 
  select concept_id from @vocabulary_database_schema.CONCEPT where concept_id in (1945039,1945044,1945047,1945048,1918194,1918199,1918205,1918209,1918211,1918203,1855389,1855391,801092,801095,799037,37759012,2110516,1424889,799038,799040,1539251,1536142,1536144,1536147,1536148,1424899,1607111,1607112,580261,2110513,799034,966540,966538,2110510,1190225,1190220,2045382,2045377,833470,1998774,630208,1998773,1720953,1998772,1720948,966536,1998771,790206,790207,1511445,1511446,40173401,40173402,40173403,40173404,40243202,40243203,44814264,35519070,44814265,44814266,44464877,44814267,3943418,42708504,36501739,780240,42708505,36348221,42708508,780239,42708509,40173399,40173400,42708374,42708375,40169216,44446929,40169217,45117948,40169218,3943566,40169219,40169230,40169231,3943564,40169232,40169233,40169234,40169235,3943565,40169236,40169237,42629523,42629527,1361703,36118129,1361704,36118130,42708510,36118123,42708511,42708512,36118126,42708513,1361705,1361706,44818261,44818262,44818265,44818266,19127762,19127763,792485,792490,43531861,45775246,45776183,45776184,37003602,37003603,46234368,46234370,45776186,45776297,40169242,40169243,40169244,40169245,40169246,40169247,19127768,44896850,905271,46234464,35524519,46234508,46253755,46254635,1113041,35524520,1113079,44463071,1192251,44432825,35700165,1192272,45279245,45085908,40169204,40169205,40242513,40242514,46233856,46233860,40166837,44898811,40166838,35603332,35603333,45774779,45774780,37499734,37499739,46221170,36104603,46221171,1201587,1201588,1510779,1510780,792493,792494,600058,43531871,45775248,45776178,45776180,37003604,37003605,600059,46234373,46234374,45776300,45776301,19129676,19129677,905292,905293,44785540,44785541,45774870,45775241,2017515274,1944077,37499737,36601732,37499738,42873622,36104730,42873623,42708514,42708515,40173447,40173448,42708516,42708517,19130453,42844311,19130455,42844312,45330321,19130450,42844309,19130452,42844310,45159346,42708372,42708373,40169262,40169263,40169264,40169267,35700467,1593840,36197498,1593842,44437873,44417367,40169269,737789,585185,40169270,44935879,1366746,40169271,40169272,35700469,1593825,36197497,1593830,44413237,44450125,40169275,40169276,40169279,40169280,35700468,1593834,35519114,1593836,44443283,44440529,40169281,36977827,737790,42519849,635456,585186,40169282,44466473,1366747,1528945,40169283,40169284,737791,40169285,585187,40169286,1366748,46276021,36118124,46276022,36118125,46276023,36118127,46276024,36118128,905294,905295,46233863,46233864,45775128,45775129,40166801,40166802,35603327,35603329,45774774,45774776,44785544,44785545,45892417,45892418,44887172,45057334,44587423,41931827,41893441,963844,36497272,963845,963842,36497797,963843,41973648,35316851,42068005,1958267,41890626,43232549,41951414,1142116,1511248,42637463,35198771,833002,37407545,769422,36330313,36117133,36389446,35839253,35500520,1154621,36397943,45360336,35905256,1511247,1372438,35505692,42695134,1226338,40163900,42842422,44437522,45036162,45376084,44465650,19131109,45868557,19131111,46252607,36180773,36179415,45343168,37517854,36176811,1511246,36090720,36773036,42647605,36348087,800337,42646473,42867665,36007110,36327180,36389449,37316231,36007007,1225952,1994735,36090719,1565790,42695135,35839254,1357952,36389448,36992096,1154619,46365057,36180766,45280628,45212589,44461325,45189395,45056205,41953013,40220058,41955720,1305337,4048422,3188883,789792,36008282,789793,36008283,36008284,36008285,37002845,36381127,37002847,36381134,37002855,37002856,37002842,36381129,37002844,36381136,37002851,37002852,37002848,36381130,37002850,36381138,37002853,37002854,36798759,1154536,36327177,36327178,36327179,1627092,1983701,1983702,1627093,43547706,37413344,1154535,36327174,36327175,36327176,1627090,1983703,1983704,1627091,43547707,37413343,19098331,45307601,19123989,36918293,36669365,36401523,1743569,36182618,45866440,44424551,45142023,45159175,593118,1583098,36868847,36496236,36497719,36496681,36497196,1530313,36389447,45144172,45042269,44889065,45025201,37418248,1530312,45378614,36353344,36348086,44463020,44463021,707871,707872,769306,36117134,36117135,36117136,44966486,42887763,44884698,45122305,45208253,43560451,37618303,37298951,37618304,37298952,37298953,46329752,46332759,42684617,35108374,37519780,823334,823335,36977475,35531135,726042,46330748,45871475,45865159,36479821,36480210,593119,36467210,36324167,36998070,44956990,45195422,44973981,45212705,44956991,36008766,36181234,1987363,45037488,3946259,44463128,36330562,1566876,999023,36143144,36143145,43560452,45290648,45051665,1154380,36301510,44955448,45020340,44433710,45188098,44900163,3963710,36301614,1111242,42635667,42635675,37319645,37319646,36869444,42635687,1579104,37319643,37319644,36868896,35300683,35300682,36318339,36318225,36200384,36200383,35301113,35301216,599311,599312,37319640,37319642,1828574,35301210,599313,599314,42635766,42635757,36117267,36117268,36333096,36333097,36348008,1544357,1111243,45006119,45330322,45023263,45040346,45040347,45142216,44887174,45176483,3970379,3964015,42708518,3949094,3949153,3946217,3946218,1623247,1116470,1116469,36324146,36324147,36332493,35700464,35700463,621810,834571,834570,42708519,42867952,44966258,45324613,44409191,42708523,42708524,35605107,35605109,40240666,44408310,40240667,44426066,1113076,44425525,44451460,44446002,44446003,44414568,44417355,36330561,45864465,45209959,44921159,45296217,593117,1583304,45297000,45127186,45246918,45178343,45315265,36351073,44986228,3946258,44436578,45151878,42643710,42664317,42664318,42664319,45276766,19096798,44444652,44410524,45211853,44905380,44412253,44420522,44436912,44442267,44451852,44427314,44420523,44434074,42796838,37415494,37415495,45874699,45864189,829749,43547672,44781522,44781523,1192247,46253040,46255275,1192221,42826570,44448767,44439200,45177504,45041431,45195421,44449147,44413608,44419152,44427315,44427316,44421865,44416378,44451853,42796839,37415496,3943629,45863871,45874400,829750,43547673,44781524,44781525,1192220,46254313,46249205,1192219,44435096,44437860,45058443,45075540,45315264,44410916,44425899,44445050,44421866,44436913,44412254,44438217,44420524,42796840,37415493,45874155,45872007,829748,43547674,44781520,44781521,19133818,46255769,46253103,1718292,44429645,44421500,1718294,46251680,46248913,19112761,3963160,35801782,19121580,1765164,35110881)

) I
) C UNION ALL 
SELECT 12 as codeset_id, c.concept_id FROM (select distinct I.concept_id FROM
( 
  select concept_id from @vocabulary_database_schema.CONCEPT where concept_id in (42708372,42708373,42708374,42708375,40240666,40240667,42708504,42708505,42708508,44818261,44818262,46234508,43531871,43531861,40242513,40242514,37499737,37499738,37499734,37499739,780239,780240,1192221,46234368,46234370,46234373,46234374,792490,792493,792494,19129676,19129677,19131109,1113041,1113076,1113079,1593830,1593834,1593836,42826570,44425525,44451460,44446002,44446003,44414568,44417355,37618303,37298951,37618304,37298952,37298953,44432825,46329752,46332759,44429645,44421500,44444652,44410524,44448767,44439200,44435096,44437860,36397943,36090720,3963160,35801782,36918293,45868557,46252607,3963710,45006119,45330322,45023263,45040346,45040347,45142216,44887174,45176483,3970379,42684617,35108374,37519780,823334,823335,46365057,36180766,36180773,1593840,1593842,40169242,40169243,40169269,40169270,40169244,40169245,40169281,40169282,40169246,40169247,40169285,40169286,40169262,40169263,40169218,40169219,40169275,40169276,40169232,40169233,1154380,1192219,19098331,1366746,1366747,1366748,1192220,45892417,45892418,42629523,42629527,1511246,1511247,1511248,37003602,1305337,36773036,36179415,42635667,42635675,37319645,37319646,36330561,36669365,36401523,1743569,36977475,1142116,3943566,3943564,3943565,600058,600059,42842422,35531135,726042,42637463,36869444,42635687,1579104,37319643,37319644,46330748,45871475,45865159,42844311,42844312,42844309,42844310,37003603,37003604,37003605,44814266,44814267,46233856,46233860,46233863,46233864,42708509,42708510,42708511,42708512,42708513,42708514,42708515,42708516,42708517,42708518,42708519,42708523,42708524,1511445,1511446,37002842,37002844,37002845,37002847,37002848,37002850,37002851,37002852,37002853,37002854,37002855,37002856,792485,46234464,789792,789793,40243202,40243203,46221170,46221171,1154619,1192251,46276021,46276022,46276023,46276024,19131111,40169279,40169280,40169236,40169237,42873622,42873623,44814264,44814265,45775128,45775129,963842,963843,963844,963845,1361704,1361705,1361706,35605107,35605109,45774870,1718292,1718294,1510779,1510780,1361703,1201587,1201588,1192247,45774774,45774776,45774779,737789,737790,737791,37319640,37319642,1828574,42519849,45297000,36327177,36327178,36327174,36327175,36327179,36327176,36601732,36104730,36104603,35505692,1530313,635456,35301210,599313,599314,42635766,42635757,36117267,36117268,621810,834571,834570,45195421,45315264,1627092,1983701,1983702,1958267,1944077,790206,790207,1593825,1154535,1154536,19112761,40163900,40169216,40169217,40169230,40169231,40169234,40169235,40169264,40169267,40169271,40169272,40169283,40169284,40169204,40169205,1111242,19121580,905271,905292,905293,905294,905295,44785544,44785545,44785540,44785541,45776178,45776180,45776183,45776184,45776186,45776297,45776300,45776301,35603327,42647605,36977827,45864465,45209959,36868896,35300683,35300682,36182618,45280628,45866440,3949094,3949153,3946217,3946218,36318339,45774780,1192272,40166837,40166838,40166801,40166802,19133818,19123989,1111243,1154621,19127762,19127763,19127768,45775241,45775246,45775248,35603329,35603332,35603333,19130450,19130452,19130453,19130455,40173399,40173400,40173447,40173448,40173401,40173402,40173403,40173404,44818265,44818266,19096798,43560451,43560452,40220058,36318225,36200384,36200383,35198771,35301113,35301216,599311,599312,1623247,1116470,1116469,44424551,833002,36324146,36324147,36332493,36348087,1372438,800337,45211853,44905380,45177504,45041431,45058443,45075540,45279245,44887172,45057334,44408310,44426066,45330321,45159346,1627093,1627090,1983703,36327180,36330313,45212589,36389447,36389449,1983704,1627091,36333096,36333097,36348008,1544357,45127186,45246918,45178343,45315265,45144172,45042269,44889065,45025201,44956990,45195422,44973981,45212705,44956991,44412253,36798759,44420522,44436912,44442267,44451852,44427314,1528945,44420523,44434074,44449147,44413608,44419152,44427315,44427316,44421865,44416378,44451853,44410916,44425899,44445050,44421866,44436913,44412254,44438217,44420524,44446929,37418248,42796838,44587423,36348221,45020340,44986228,45037488,45378614,36353344,45343168,45036162,36348086,3946259,3946258,44436578,44463128,36330562,44463020,44463021,44433710,45189395,35524519,35519114,36090719,35316851,4048422,585187,35110881,36992096,45188098,44465650,35905256,42887763,36501739,44900163,1226338,44884698,45276766,44437873,44417367,44413237,44450125,44443283,44440529,45122305,44935879,36381127,36008282,36008283,36381129,36381130,36497272,36497797,36381134,36381136,36381138,36008284,36008285,45056205,46253755,46254635,45208253,36479821,36480210,45142023,45159175,44921159,45296217,593117,1583304,593118,1583098,593119,36467210,35700469,35700468,35700467,35700464,35700463,35700165,37407545,36301510,42646473,42867665,36868847,36324167,44437522,36496236,36497719,36496681,36497196,769422,36007110,44955448,36998070,37415494,37415495,42796839,37415496,42796840,37415493,36008766,36181234,37316231,36351073,3943629,3943418,35524520,1987363,44466473,46251680,46248913,46253040,46255275,46254313,46249205,46255769,46253103,1530312,36007007,45874155,45872007,45863871,45874400,45874699,45864189,1765164,36118129,36118130,36118126,36118127,36118128,36118123,36118124,36118125,37517854,36117133,1565790,44896850,45151878,36197497,36197498,36389446,35839253,35500520,43547706,37413344,43547707,37413343,42695134,42695135,35839254,585185,585186,44463071,1357952,42867952,44966258,45324613,44409191,45290648,45051665,45360336,1566876,36389448,45117948,36176811,829749,829750,1225952,1994735,36301614,44461325,44464877,3964015,3188883,829748,43547672,44781522,44781523,43547673,44781524,44781525,43547674,44781520,44781521,999023,36143144,36143145,45376084,35519070,707871,707872,769306,36117134,36117135,36117136,42643710,42664317,42664318,42664319,44966486,45307601,45085908,44898811,43232549,42068005,41973648,41890626,41955720,41951414,41931827,41893441,41953013)

) I
) C;

UPDATE STATISTICS #Codesets;


SELECT event_id, person_id, start_date, end_date, op_start_date, op_end_date, visit_occurrence_id
INTO #qualified_events
FROM 
(
  select pe.event_id, pe.person_id, pe.start_date, pe.end_date, pe.op_start_date, pe.op_end_date, row_number() over (partition by pe.person_id order by pe.start_date ASC) as ordinal, cast(pe.visit_occurrence_id as bigint) as visit_occurrence_id
  FROM (-- Begin Primary Events
select P.ordinal as event_id, P.person_id, P.start_date, P.end_date, op_start_date, op_end_date, cast(P.visit_occurrence_id as bigint) as visit_occurrence_id
FROM
(
  select E.person_id, E.start_date, E.end_date,
         row_number() OVER (PARTITION BY E.person_id ORDER BY E.sort_date ASC, E.event_id) ordinal,
         OP.observation_period_start_date as op_start_date, OP.observation_period_end_date as op_end_date, cast(E.visit_occurrence_id as bigint) as visit_occurrence_id
  FROM 
  (
  -- Begin Condition Occurrence Criteria
SELECT C.person_id, C.condition_occurrence_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id, C.start_date as sort_date
FROM 
(
  SELECT co.person_id,co.condition_occurrence_id,co.condition_concept_id,co.visit_occurrence_id,co.condition_start_date as start_date, COALESCE(co.condition_end_date, DATEADD(day,1,co.condition_start_date)) as end_date 
  FROM @cdm_database_schema.CONDITION_OCCURRENCE co
  JOIN #Codesets cs on (co.condition_concept_id = cs.concept_id and cs.codeset_id = 6)
) C

WHERE (C.start_date >= DATEFROMPARTS(2018, 1, 1) and C.start_date <= DATEFROMPARTS(2019, 8, 30))
-- End Condition Occurrence Criteria

  ) E
	JOIN @cdm_database_schema.observation_period OP on E.person_id = OP.person_id and E.start_date >=  OP.observation_period_start_date and E.start_date <= op.observation_period_end_date
  WHERE DATEADD(day,180,OP.OBSERVATION_PERIOD_START_DATE) <= E.START_DATE AND DATEADD(day,1,E.START_DATE) <= OP.OBSERVATION_PERIOD_END_DATE
) P
WHERE P.ordinal = 1
-- End Primary Events
) pe
  
) QE

;

--- Inclusion Rule Inserts

select 0 as inclusion_rule_id, person_id, event_id
INTO #Inclusion_0
FROM 
(
  select pe.person_id, pe.event_id
  FROM #qualified_events pe
  
JOIN (
-- Begin Criteria Group
select 0 as index_id, person_id, event_id
FROM
(
  select E.person_id, E.event_id 
  FROM #qualified_events E
  INNER JOIN
  (
    -- Begin Criteria Group
select 0 as index_id, person_id, event_id
FROM
(
  select E.person_id, E.event_id 
  FROM #qualified_events E
  INNER JOIN
  (
    -- Begin Correlated Criteria
select 0 as index_id, p.person_id, p.event_id
from #qualified_events p
LEFT JOIN (
SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 8)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc on p.person_id = cc.person_id and p.event_id = cc.event_id
GROUP BY p.person_id, p.event_id
HAVING COUNT(cc.event_id) <= 1
-- End Correlated Criteria

UNION ALL
-- Begin Correlated Criteria
select 1 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 9)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) >= 3
-- End Correlated Criteria

  ) CQ on E.person_id = CQ.person_id and E.event_id = CQ.event_id
  GROUP BY E.person_id, E.event_id
  HAVING COUNT(index_id) = 2
) G
-- End Criteria Group

UNION ALL
-- Begin Criteria Group
select 1 as index_id, person_id, event_id
FROM
(
  select E.person_id, E.event_id 
  FROM #qualified_events E
  INNER JOIN
  (
    -- Begin Correlated Criteria
select 0 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 8)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) = 2
-- End Correlated Criteria

UNION ALL
-- Begin Correlated Criteria
select 1 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 9)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) >= 3
-- End Correlated Criteria

  ) CQ on E.person_id = CQ.person_id and E.event_id = CQ.event_id
  GROUP BY E.person_id, E.event_id
  HAVING COUNT(index_id) = 2
) G
-- End Criteria Group

UNION ALL
-- Begin Criteria Group
select 2 as index_id, person_id, event_id
FROM
(
  select E.person_id, E.event_id 
  FROM #qualified_events E
  INNER JOIN
  (
    -- Begin Correlated Criteria
select 0 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 8)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) = 3
-- End Correlated Criteria

UNION ALL
-- Begin Correlated Criteria
select 1 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 9)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) >= 3
-- End Correlated Criteria

  ) CQ on E.person_id = CQ.person_id and E.event_id = CQ.event_id
  GROUP BY E.person_id, E.event_id
  HAVING COUNT(index_id) = 2
) G
-- End Criteria Group

UNION ALL
-- Begin Criteria Group
select 3 as index_id, person_id, event_id
FROM
(
  select E.person_id, E.event_id 
  FROM #qualified_events E
  INNER JOIN
  (
    -- Begin Correlated Criteria
select 0 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 8)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) = 4
-- End Correlated Criteria

UNION ALL
-- Begin Correlated Criteria
select 1 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 9)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) >= 3
-- End Correlated Criteria

  ) CQ on E.person_id = CQ.person_id and E.event_id = CQ.event_id
  GROUP BY E.person_id, E.event_id
  HAVING COUNT(index_id) = 2
) G
-- End Criteria Group

UNION ALL
-- Begin Criteria Group
select 4 as index_id, person_id, event_id
FROM
(
  select E.person_id, E.event_id 
  FROM #qualified_events E
  INNER JOIN
  (
    -- Begin Correlated Criteria
select 0 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 8)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) = 5
-- End Correlated Criteria

UNION ALL
-- Begin Correlated Criteria
select 1 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 9)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) >= 3
-- End Correlated Criteria

  ) CQ on E.person_id = CQ.person_id and E.event_id = CQ.event_id
  GROUP BY E.person_id, E.event_id
  HAVING COUNT(index_id) = 2
) G
-- End Criteria Group

UNION ALL
-- Begin Criteria Group
select 5 as index_id, person_id, event_id
FROM
(
  select E.person_id, E.event_id 
  FROM #qualified_events E
  INNER JOIN
  (
    -- Begin Correlated Criteria
select 0 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 8)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) = 6
-- End Correlated Criteria

UNION ALL
-- Begin Correlated Criteria
select 1 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 9)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) >= 3
-- End Correlated Criteria

  ) CQ on E.person_id = CQ.person_id and E.event_id = CQ.event_id
  GROUP BY E.person_id, E.event_id
  HAVING COUNT(index_id) = 2
) G
-- End Criteria Group

UNION ALL
-- Begin Criteria Group
select 6 as index_id, person_id, event_id
FROM
(
  select E.person_id, E.event_id 
  FROM #qualified_events E
  INNER JOIN
  (
    -- Begin Correlated Criteria
select 0 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 8)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= P.OP_START_DATE ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) >= 7
-- End Correlated Criteria

UNION ALL
-- Begin Correlated Criteria
select 1 as index_id, cc.person_id, cc.event_id
from (SELECT p.person_id, p.event_id 
FROM #qualified_events P
JOIN (
  -- Begin Drug Exposure Criteria
select C.person_id, C.drug_exposure_id as event_id, C.start_date, C.end_date,
  C.visit_occurrence_id,C.start_date as sort_date
from 
(
  select de.person_id,de.drug_exposure_id,de.drug_concept_id,de.visit_occurrence_id,days_supply,quantity,refills,de.drug_exposure_start_date as start_date, COALESCE(de.drug_exposure_end_date, DATEADD(day,de.days_supply,de.drug_exposure_start_date), DATEADD(day,1,de.drug_exposure_start_date)) as end_date 
  FROM @cdm_database_schema.DRUG_EXPOSURE de
JOIN #Codesets cs on (de.drug_concept_id = cs.concept_id and cs.codeset_id = 9)
) C


-- End Drug Exposure Criteria

) A on A.person_id = P.person_id  AND A.START_DATE >= P.OP_START_DATE AND A.START_DATE <= P.OP_END_DATE AND A.START_DATE >= DATEADD(day,-548,P.START_DATE) AND A.START_DATE <= DATEADD(day,0,P.START_DATE) ) cc 
GROUP BY cc.person_id, cc.event_id
HAVING COUNT(cc.event_id) >= 2
-- End Correlated Criteria

  ) CQ on E.person_id = CQ.person_id and E.event_id = CQ.event_id
  GROUP BY E.person_id, E.event_id
  HAVING COUNT(index_id) = 2
) G
-- End Criteria Group

  ) CQ on E.person_id = CQ.person_id and E.event_id = CQ.event_id
  GROUP BY E.person_id, E.event_id
  HAVING COUNT(index_id) > 0
) G
-- End Criteria Group
) AC on AC.person_id = pe.person_id AND AC.event_id = pe.event_id
) Results
;

SELECT inclusion_rule_id, person_id, event_id
INTO #inclusion_events
FROM (select inclusion_rule_id, person_id, event_id from #Inclusion_0) I;
TRUNCATE TABLE #Inclusion_0;
DROP TABLE #Inclusion_0;


select event_id, person_id, start_date, end_date, op_start_date, op_end_date
into #included_events
FROM (
  SELECT event_id, person_id, start_date, end_date, op_start_date, op_end_date, row_number() over (partition by person_id order by start_date ASC) as ordinal
  from
  (
    select Q.event_id, Q.person_id, Q.start_date, Q.end_date, Q.op_start_date, Q.op_end_date, SUM(coalesce(POWER(cast(2 as bigint), I.inclusion_rule_id), 0)) as inclusion_rule_mask
    from #qualified_events Q
    LEFT JOIN #inclusion_events I on I.person_id = Q.person_id and I.event_id = Q.event_id
    GROUP BY Q.event_id, Q.person_id, Q.start_date, Q.end_date, Q.op_start_date, Q.op_end_date
  ) MG -- matching groups

  -- the matching group with all bits set ( POWER(2,# of inclusion rules) - 1 = inclusion_rule_mask
  WHERE (MG.inclusion_rule_mask = POWER(cast(2 as bigint),1)-1)

) Results
WHERE Results.ordinal = 1
;



-- generate cohort periods into #final_cohort
select person_id, start_date, end_date
INTO #cohort_rows
from ( -- first_ends
	select F.person_id, F.start_date, F.end_date
	FROM (
	  select I.event_id, I.person_id, I.start_date, CE.end_date, row_number() over (partition by I.person_id, I.event_id order by CE.end_date) as ordinal
	  from #included_events I
	  join ( -- cohort_ends
-- cohort exit dates
-- By default, cohort exit at the event's op end date
select event_id, person_id, op_end_date as end_date from #included_events
    ) CE on I.event_id = CE.event_id and I.person_id = CE.person_id and CE.end_date >= I.start_date
	) F
	WHERE F.ordinal = 1
) FE;

select person_id, min(start_date) as start_date, end_date
into #final_cohort
from ( --cteEnds
	SELECT
		 c.person_id
		, c.start_date
		, MIN(ed.end_date) AS end_date
	FROM #cohort_rows c
	JOIN ( -- cteEndDates
    SELECT
      person_id
      , DATEADD(day,-1 * 0, event_date)  as end_date
    FROM
    (
      SELECT
        person_id
        , event_date
        , event_type
        , SUM(event_type) OVER (PARTITION BY person_id ORDER BY event_date, event_type ROWS UNBOUNDED PRECEDING) AS interval_status
      FROM
      (
        SELECT
          person_id
          , start_date AS event_date
          , -1 AS event_type
        FROM #cohort_rows

        UNION ALL


        SELECT
          person_id
          , DATEADD(day,0,end_date) as end_date
          , 1 AS event_type
        FROM #cohort_rows
      ) RAWDATA
    ) e
    WHERE interval_status = 0
  ) ed ON c.person_id = ed.person_id AND ed.end_date >= c.start_date
	GROUP BY c.person_id, c.start_date
) e
group by person_id, end_date
;

DELETE FROM @target_database_schema.@target_cohort_table where cohort_definition_id = @target_cohort_id;
INSERT INTO @target_database_schema.@target_cohort_table (cohort_definition_id, subject_id, cohort_start_date, cohort_end_date)
select @target_cohort_id as cohort_definition_id, person_id, start_date, end_date 
FROM #final_cohort CO
;






TRUNCATE TABLE #cohort_rows;
DROP TABLE #cohort_rows;

TRUNCATE TABLE #final_cohort;
DROP TABLE #final_cohort;

TRUNCATE TABLE #inclusion_events;
DROP TABLE #inclusion_events;

TRUNCATE TABLE #qualified_events;
DROP TABLE #qualified_events;

TRUNCATE TABLE #included_events;
DROP TABLE #included_events;

TRUNCATE TABLE #Codesets;
DROP TABLE #Codesets;
